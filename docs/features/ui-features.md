# 画面・UI機能詳細：AIペットアイコンジェネレーター「AniMe」

## 実装タスク一覧

### 🏗️ 全体基盤・共通レイアウト

- [x] **Nuxt UI セットアップ**
  - `@nuxt/ui` のインストールと `nuxt.config.ts` の基本設定
  - `tailwind.config.ts` の基本設定（カスタムテーマ用）
- [x] **カラーテーマ設定**
  - アプリのキーカラー（コーラルピンク系）を `primary` に設定
  - `app.config.ts` または `tailwind.config.ts` でカスタムカラー定義
- [x] **共通レイアウト作成**
  - `layouts/default.vue` にヘッダー（ロゴ、ヘルプボタン）とメインコンテンツエリアを実装
  - `UContainer`、`UHeader`、`UMain` を使用
- [x] **ダークモード対応**
  - `UColorModeButton` を利用した配色確認
  - システム設定に応じた自動切り替え
- [x] **トースト通知の実装**
  - `UNotifications` を使用したエラー・成功時のフィードバック基盤作成
  - `useToast` composable のラッパー関数作成
- [x] **Piniaストアのセットアップ**
  - `@pinia/nuxt` モジュールのインストールと `nuxt.config.ts` への追加
  - `stores/` ディレクトリの作成と基本構造の定義
  - 生成関連のストア (`stores/generation.ts`) の作成

### 📱 画面 1：トップ画面（生成設定）

ユーザーが最初に訪れる、シンプルでワクワク感のあるメイン画面。

- [x] **アップロードエリアの作成**
  - `UFileUpload` を使用したドラッグ&ドロップエリア実装
  - プレビュー機能の連動
  - 写真未選択時は「可愛い写真を選んでね」というプレースホルダーを表示
- [x] **スタイルセレクターの実装**
  - `UButton` または `URadioGroup` をカスタマイズし、アイコン付きのスタイル選択肢を実装
  - 対応スタイル：3Dアニメ、水彩画、ゆるふわ手書き、サイバーパンク、韓国風、シンプルイラスト
  - 選択中のスタイルを視覚的に強調するハイライト表示
- [x] **生成ボタンの実装**
  - `UButton` を使用
  - 画像未選択時の `disabled` 制御と、ローディング状態（`loading` プロパティ）の切り替え
  - 押下時にバックエンドAPIへリクエストを送信し、生成中画面へ遷移
- [x] **追加入力エリアの実装**
  - **フリーテキスト入力**: `UTextarea` を使用した複数行テキスト入力エリア
  - ペットの特徴や要望を自由に入力できる（例：「リボンをつけて」「笑顔で」等）
- [x] **ステート管理（Pinia）**
  - Piniaストアのセットアップと設定
  - 画像データ、選択スタイル、フリーテキスト入力を保持する Pinia store の定義
  - コンポーネント間での状態共有
  - ストアの構造: `stores/generation.ts` に生成関連の状態を集約

### ⏳ 画面 2：生成中画面（広告・待機演出）

離脱を防ぎつつ、広告を確実に閲覧してもらうための画面。

- [ ] **プログレスバーの実装**
  - `UProgress` を使用。0から100%までのシミュレーションアニメーション作成
  - AIの処理進捗を示すアニメーションゲージ
- [ ] **ステータスメッセージのランダム表示**
  - `setInterval` を用いたテキストの切り替えロジック実装
  - 「毛並みを整えています...」「魔法をかけています...」といったランダムなステータスメッセージ表示
- [ ] **広告エリアの構築**
  - `UCard` を使用した中央広告枠のプレースホルダー作成
  - 画面中央の最も目立つ位置に配置
- [ ] **待機時間タイマーの実装**
  - 指定時間（10秒等）が経過するまで「次へ」ボタンを非表示、または自動遷移するロジックの実装
  - 生成が完了しても、最低待機時間が経過するまで次の画面へ進ませない制御
- [ ] **背景アニメーション**
  - 足跡が歩き回るような CSS アニメーションの追加
  - ブランドイメージの定着を目的とした可愛いローディング演出
- [x] **生成失敗時のエラー表示**
  - Realtime でジョブが `failed` になったときに `UAlert` でユーザー向けメッセージを表示
  - 「もう一度やり直す」ボタンでストアをリセットしトップへ戻る

### ✨ 画面 3：結果・プレビュー画面

完成したアイコンを確認し、保存・拡散してもらうための画面。

- [ ] **メイン画像表示**
  - 生成された画像を大きく表示
  - `UAspectRatio` で比率を維持
  - Vercel Blobから取得した生成完了画像を表示
- [ ] **SNSシミュレーターの実装**
  - `UToggle` を使用した「円形マスク」のON/OFF切り替え
  - `v-if` または CSS の `border-radius: 50%` を用いたプレビュー表示の切り替え
  - 実際のXやInstagramのプロフィール画面を模したモックアップ表示
- [ ] **アクションボタンの実装**
  - **ダウンロードボタン (`UButton`)**: 広告視聴フラグを確認して有効化。クリックで端末へ保存
  - **SNSシェアボタン (`UButtonGroup` または `UButton`)**: X(旧Twitter)連携用のURL生成
  - **リトライボタン (`UButton`)**: ステートをリセットしてトップへ戻るルーティング
- [ ] **フィードバックボタン**
  - `UIcon` を使用した Good/Bad ボタンの実装
  - 「可愛い！」「イメージと違う」などの簡易リアクション（AI精度改善の参考データ用）

## 1. トップ画面（生成設定）

ユーザーが最初に訪れる、シンプルでワクワク感のあるメイン画面。

> 📸 **参考画像**: [トップ画面イメージ](/images/top.png)

### トップ画面の実装詳細

- [x] **ヘッダーコンポーネント**
  - サービスロゴ（AniMe）
  - 簡易ガイドボタン（「使い方」モーダルへのリンク）
  - 使用コンポーネント: `UHeader`、`UButton`、`UModal`
- [x] **画像アップロードエリア**
  - プレビュー付きアップローダー（選択したペット写真を表示）
  - ファイル選択/ドラッグ＆ドロップ対応
  - ※写真未選択時は「可愛い写真を選んでね」というプレースホルダーを表示
  - 使用コンポーネント: `UFileUpload`
- [x] **スタイルセレクター（カルーセルまたはグリッド）**
  - アイコン付きのスタイル選択ボタン（3Dアニメ、水彩画、ゆるふわ手書き、サイバーパンク、韓国風、シンプルイラスト）
  - 選択中のスタイルを視覚的に強調するハイライト表示
  - 使用コンポーネント: `UButton`、`URadioGroup`、`UIcon`
- [x] **追加入力エリア**
  - **フリーテキスト入力**: ペットの特徴や要望を自由に入力できるテキストエリア
  - 例：「リボンをつけて」「笑顔で」「背景をシンプルに」など、生成時の追加要望を入力
  - 使用コンポーネント: `UTextarea`
- [x] **生成実行ボタン**
  - 写真がアップロードされるまで「Disabled（無効）」状態
  - 押下時にバックエンドAPIへリクエストを送信し、生成中画面へ遷移
  - 使用コンポーネント: `UButton` (loading, disabled プロパティ)

## 2. 生成中画面（広告・待機演出）

離脱を防ぎつつ、広告を確実に閲覧してもらうための画面。

> 📸 **参考画像**: [生成中画面イメージ](/images/create.png)

### 生成中画面の実装詳細

- [x] **プログレス表示**
  - AIの処理進捗を示すアニメーションゲージ（0%〜100%）
  - 「毛並みを整えています...」「魔法をかけています...」といったランダムなステータスメッセージ表示
  - 使用コンポーネント: `UProgress`、`UText` (ステータスメッセージ)
- [x] **メイン広告エリア（重要）**
  - 画面中央の最も目立つ位置に配置された広告枠
  - 生成が完了しても、最低待機時間（例：10秒）が経過するまで次の画面へ進ませない制御
  - 使用コンポーネント: `UCard`、`UContainer`
- [x] **ローディング演出**
  - ペットの足跡が歩き回るような可愛いアニメーション（ブランドイメージの定着）
  - 使用コンポーネント: CSS アニメーション + `UIcon` (足跡アイコン)
- [x] **生成失敗時のエラー表示**
  - ジョブが失敗（API エラー・クォータ超過など）した場合、`UAlert` で「生成に失敗しました」とバックエンドのユーザー向けメッセージを表示
  - 「もう一度やり直す」ボタンでストアをリセットしトップ画面へ遷移

## 3. 結果・プレビュー画面

完成したアイコンを確認し、保存・拡散してもらうための画面。

> 📸 **参考画像**: [結果画面イメージ](/images/result.png)

### 結果画面の実装詳細

- [ ] **メインプレビューエリア**
  - Vercel Blobから取得した生成完了画像を表示
  - 使用コンポーネント: `UAspectRatio`、`NuxtImg` (画像最適化)
- [ ] **SNSアイコンシミュレーター（Toggle式）**
  - 「円形マスク」をON/OFFできる切り替えスイッチ
  - 実際のXやInstagramのプロフィール画面を模したモックアップ表示
  - 使用コンポーネント: `UToggle`、`UCard` (モックアップ表示)
- [ ] **アクションボタン群**
  - **ダウンロードボタン:** 広告視聴後に有効化。クリックで端末へ保存
  - **SNSシェアボタン:** 生成完了報告（ハッシュタグ付き）をX等へ投稿
  - **リトライボタン:** 「もう一度作る（トップへ戻る）」
  - 使用コンポーネント: `UButton`、`UButtonGroup`、`UIcon`
- [ ] **フィードバックボタン**
  - 「可愛い！」「イメージと違う」などの簡易リアクション（AI精度改善の参考データ用）
  - 使用コンポーネント: `UButton`、`UIcon` (Good/Bad アイコン)

## 4. 共通UI・UX要素

### 共通UI要素の実装詳細

- [x] **レスポンシブ・トースト通知**
  - エラー時（画像が不適切、サーバー混雑等）のポップアップ通知
  - 使用コンポーネント: `UNotifications`、`useToast` composable
- [x] **ダークモード対応**
  - システム設定に応じた配色の自動切り替え
  - 使用コンポーネント: `UColorModeButton`、`UColorMode` composable
- [ ] **トランジションアニメーション**
  - 画面遷移時のスムーズなフェードイン/アウト
  - 使用: Nuxt の `<Transition>` コンポーネント

## 🛠️ Nuxt UI コンポーネント対応表

### 機能別使用コンポーネント一覧

| 機能 | 使用予定の Nuxt UI コンポーネント | 用途 |
| ---- | -------------------------------- | ---- |
| **全体構造** | `UApp`、`UContainer`、`UCard` | アプリ全体のラッパー、コンテンツの中央配置、カードレイアウト |
| **レイアウト** | `UHeader`、`UMain`、`UFooter` | ヘッダー、メインコンテンツ、フッター |
| **ボタン類** | `UButton`、`UButtonGroup` | 生成ボタン、アクションボタン、ボタングループ |
| **入力/選択** | `UFileUpload`、`UTextarea`、`URadioGroup`、`UToggle` | ファイルアップロード、フリーテキスト入力、スタイル選択、SNSシミュレーター切り替え |
| **進行状況** | `UProgress` | 生成進捗の表示 |
| **通知/ガイド** | `UNotifications`、`UModal`、`UTooltip` | トースト通知、使い方モーダル、ツールチップ |
| **アイコン** | `UIcon` (Iconify 連携) | 各種アイコン表示（@iconify-json/lucide を使用） |
| **画像** | `NuxtImg` (via @nuxt/image) | 画像の最適化と表示 |
| **アスペクト比** | `UAspectRatio` | 画像のアスペクト比維持 |
| **カラーモード** | `UColorModeButton` | ダークモード切り替え |

### コンポーネント詳細

#### レイアウト系

- **UApp**: アプリ全体のラッパーコンポーネント
- **UContainer**: コンテンツの最大幅を制限し、中央配置
- **UHeader**: レスポンシブなヘッダーコンポーネント
- **UMain**: メインコンテンツエリア
- **UCard**: カード形式のコンテンツ表示

#### フォーム系

- **UFileUpload**: ファイルアップロード用のコンポーネント（ドラッグ&ドロップ対応、プレビュー機能付き）
- **UTextarea**: フリーテキスト入力用の複数行テキストエリア
- **URadioGroup**: スタイル選択用のラジオボタングループ
- **UToggle**: SNSシミュレーターの円形マスク切り替え

#### ボタン系

- **UButton**: 各種アクションボタン（生成、ダウンロード、シェア、リトライ）
- **UButtonGroup**: 複数のボタンをグループ化

#### 表示系

- **UProgress**: 生成進捗のプログレスバー
- **UIcon**: Iconify 連携によるアイコン表示
- **UAspectRatio**: 画像のアスペクト比を維持
- **NuxtImg**: 画像の最適化と遅延読み込み

#### 通知系

- **UNotifications**: トースト通知の表示
- **UModal**: 使い方ガイドのモーダル表示
- **UTooltip**: ツールチップ表示

#### カラーモード系

- **UColorModeButton**: ダークモード切り替えボタン

## 実装時の注意事項

1. **NuxtUIコンポーネントの優先使用**
   - カスタムコンポーネントを作成する前に、NuxtUIの標準コンポーネントで実装可能か確認すること
   - 必要最小限のカスタマイズに留めること

2. **レスポンシブデザイン**
   - モバイルファーストアプローチで実装すること
   - Tailwind CSS のブレークポイントを活用すること

3. **アクセシビリティ**
   - 適切な `aria-label` や `aria-describedby` を設定すること
   - キーボード操作に対応すること

4. **パフォーマンス**
   - 画像は `NuxtImg` を使用して最適化すること
   - 遅延読み込み（lazy-loading）を適切に設定すること

5. **エラーハンドリング**
   - エラー発生時は `UNotifications` でユーザーフレンドリーなメッセージを表示すること
   - エラー詳細はログに記録し、ユーザーには簡潔なメッセージのみを表示すること

6. **ステート管理（Pinia）**
   - ステート管理は **Pinia** で統一すること
   - ページ間での状態共有には Pinia store を使用すること
   - 画像データ、選択スタイル、フリーテキスト入力は Pinia store で管理すること
   - ストアは `stores/` ディレクトリに配置し、機能ごとに分割すること（例: `stores/generation.ts`）
   - Piniaストアの命名規則: `use[機能名]Store`（例: `useGenerationStore`）
   - ストアの構造例:

     ```typescript
     // stores/generation.ts
     export const useGenerationStore = defineStore('generation', {
       state: () => ({
         imageFile: null as File | null,
         imagePreview: null as string | null,
         selectedStyle: null as string | null,
         freeText: '' as string,
         jobId: null as string | null,
         status: 'idle' as 'idle' | 'generating' | 'completed' | 'error'
       }),
       actions: {
         reset() {
           // ストアをリセット
         }
       }
     })
     ```

7. **API連携**
   - バックエンドAPIとの通信は `useFetch` または `$fetch` を使用すること
   - エラーハンドリングを適切に実装すること
